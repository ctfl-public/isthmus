# Paraview INterface for Voxel and Surface OuTput (PIVOT)

## Description

This Python tool converts SPARTA **flow** and **surface** data, and LPM/LBM **solid** data, into a **ParaView-compatible format**.  
It uses **PyVista**, a lightweight VTK wrapper for Python, to read the raw data and write `.vtu`, `.vtp`, and synced `.pvd` files.  

Key features:

- Automatic conversion of flow, surface, and solid outputs to VTK formats.
- Optional **archiving** of outputs.
- **Synced timesteps**: generates a PVD file that only references timesteps present for all solvers (flow, surface, solid).  
- Postprocessing support: you can run synced PVD creation without re-running the full data conversion.  
- **Command-line interface** with adjustable logging level and postprocessing-only mode.

---

## Setup

### Method 1: Install as an Editable Package (Recommanded)

1. Clone ISTHMUS (or pull if you already have it):

```bash
git clone ssh://git@git-hypersonics.engr.uky.edu:2222/isthmus
```

2. Go to `pivot` directory:
```bash
cd isthmus/utilities/pivot
```

3. Initialize your virtual environment
```bash
python -m venv .venv
source .venv/bin/activate
```

4. Install the package in editable mode:
```bash
pip install -e . 
```

1. Now you can run anywhere (in your python environment) using 
```bash
pivot <config_file> 
```

Where `config_file` is the name of your config file. More details on how to write the config file are in the configuration section.

### Method 2: Manual Installation (alternative)

1. Clone ISTHMUS (or pull if you already have it):

```bash
git clone ssh://git@git-hypersonics.engr.uky.edu:2222/isthmus
```

2. Install dependencies (3.9 < Python < 3.12)
```bash
pip install numpy pandas pyvista tqdm tomli
```

---

## Configuration

Create a `config.toml` file in the project root with paths to your simulation outputs. 

Example:

```toml
[flow]
flow_dir = "/path/to/flow_data/"
flow_dt = 1e-9
step = 1

[solid]
solid_dir = "/path/to/solid_data/"
solid_dt = 1e-10
voxel_size = 1e-6
step = 1

[surface]
surf_data_dir = "/path/to/surf_data/"
surf_geom_dir = "/path/to/surf_geom/"
surface_dt = 1e-9
step = 1

[postprocess]
archive = true
sync_enabled = true
```

### Parameter details

- **flow**: flow field data from SPARTA
    - **flow_dir**: directory where your SPARTA flow dump files are located
    - **flow_dt**: timestep used in SPARTA simulation

- **surface**: surface data from SPARTA and ISTHMUS
    - **surf_data_dir**: directory where your `spforces` or `spetot` dumps are located
    - **surf_geom_dir**: directory of surface files generated by isthmus (used for attach the data to surface)
    - **surf_dt**: timestep used in SPARTA simulation
    - **NOTE** both `surf_data_dir` and `surf_geom_dir` are required to run surface conversion 

- **solid**: solid data from LPM/LBM output
    - **solid_dir**: directory where the solid `.csv` data is located
    - **solid_dt**: timestep used for LPM/LBM simulation
    - **voxel_size**: voxel size of solid data; set in LPM/LBM input file


- **postprocess**: optional. Can run **archiving** and/or **synced PVD creation** without reprocessing the raw simulation outputs.
    - **sync_enabled**: if `true` a synced PVD file will be generated after processing. 
    - **archive**: if `true` will automatically generate zipped outputs (if you want to transfer files)

- **step**: optional, default `1`. Determines the stride when listing files â€” `1` returns all files, `2` returns every other file, `3` every third file, and so on.

---

## Usage

### Full conversion + postprocessing (default)
```bash
pivot <config_file>
```

### Postprocessing only
Generate synced PVDs or achive output without reprocessing the simulation data:
```bash
pivot <config_file> --postprocessing=ON
```

> [!NOTE]
> Postprocessing being on assumes that the VTK and PVD files have already been generated

### Adjust logging
Control the verbosity of the console and log file output (`paraview_tools.log`):
```bash
pivot <config_file> --logging=DEBUG # developer-level messages
pivot <config_file> --logging=INFO # default user-level messages
pivot <config_file> --logging=WARNING # only warnings and errors
```


## Output

- **Flow**: `flow_output/flow_<timestep>.vtu`
- **Surface**: `surface_output/surface_<timestep>.vtp`
- **Solid**: `solid_output/solid_<timestep>.vtu`
- **Synced PVD**: `synced.pvd` pointing to all timesteps present for all specified solvers. 

## Notes
- `.vtu` files are used for flow and solid data; `.vtp` files are used for surface data
- You do **not** need to re-run the processing to generate a synced PVD.
- Synced PVD (`synced.pvd`) uses **relative paths** to the solver output directories, so it can be opened directly in ParaView without moving files.
